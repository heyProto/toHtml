!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.MediumEditorInsert=e():t.MediumEditorInsert=e()}(this,function(){return function(t){function e(n){if(i[n])return i[n].exports;var s=i[n]={exports:{},id:n,loaded:!1};return t[n].call(s.exports,s,s.exports,e),s.loaded=!0,s.exports}var i={};return e.m=t,e.c=i,e.p="",e(0)}([function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{"default":t}}Object.defineProperty(e,"__esModule",{value:!0});var s=i(2),o=n(s),a=MediumEditor.Extension.extend({name:"insert",addons:{images:!0,embeds:!0},init:function(){MediumEditor.Extension.prototype.init.apply(this,arguments),this.core=new o["default"](this)},destroy:function(){this.core.removeButtons()}});e["default"]=a,t.exports=e["default"]},function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e["default"]={ucfirst:function(t){return t.charAt(0).toUpperCase()+t.slice(1)},generateRandomString:function(){var t=arguments.length<=0||void 0===arguments[0]?15:arguments[0];return Math.random().toString(36).substr(2,t)},getClosestWithClassName:function(t,e){return MediumEditor.util.traverseUp(t,function(t){return t.classList.contains(e)})},isChildOf:function(t,e){return!!MediumEditor.util.traverseUp(t,function(t){return t===e})}},t.exports=e["default"]},function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{"default":t}}function s(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0});var o=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),a=i(1),u=n(a),l=i(4),r=n(l),d=i(3),c=n(d),f=function(){function t(e){s(this,t),this._plugin=e,this._editor=this._plugin.base,this.initAddons(),this.addButtons(),this.events()}return o(t,[{key:"events",value:function(){var t=this,e=void 0;this._plugin.on(document,"click",this.toggleButtons.bind(this)),this._plugin.on(document,"keyup",this.toggleButtons.bind(this)),this._plugin.on(this.buttons.getElementsByClassName("medium-editor-insert-buttons-show")[0],"click",this.toggleAddons.bind(this)),e=this.buttons.getElementsByClassName("medium-editor-insert-action"),Array.prototype.forEach.call(e,function(e){t._plugin.on(e,"click",t.handleAddonClick.bind(t))}),this._plugin.on(window,"resize",this.positionButtons.bind(this))}},{key:"initAddons",value:function(){var t=this;this._plugin.initializedAddons={images:new r["default"](this._plugin,this._plugin.addons.images),embeds:new c["default"](this._plugin,this._plugin.addons.embeds)},Object.keys(this._plugin.addons).forEach(function(e){var i=t._plugin.addons[e];t._plugin.initializedAddons[e]||("function"==typeof i?t._plugin.initializedAddons[e]=new i(t._plugin):window.console.error("I don't know how to initialize custom \""+e+'" addon!')),i||delete t._plugin.initializedAddons[e]})}},{key:"addButtons",value:function(){var t=this,e=void 0;this.buttons=document.createElement("div"),this.buttons.id="medium-editor-insert-"+this._plugin.getEditorId(),this.buttons.classList.add("medium-editor-insert-buttons"),this.buttons.setAttribute("contentediable",!1),e='<a class="medium-editor-insert-buttons-show">+</a>\n            <ul class="medium-editor-insert-buttons-addons">',Object.keys(this._plugin.initializedAddons).forEach(function(i){var n=t._plugin.initializedAddons[i];e+='<li><a class="medium-editor-insert-action" data-addon="'+i+'">'+n.label+"</a></li>"}),e+="</ul>",this.buttons.innerHTML=e,document.body.appendChild(this.buttons)}},{key:"removeButtons",value:function(){this.buttons.remove()}},{key:"positionButtons",value:function(){var t=void 0,e=void 0,i=void 0,n=void 0,s=void 0,o=void 0,a=void 0;this.buttons.classList.contains("medium-editor-insert-buttons-active")!==!1&&(t=this._editor.getSelectedParentElement(),e=t.getBoundingClientRect(),i=this.buttons.getElementsByClassName("medium-editor-insert-buttons-addons")[0],n=this.buttons.getElementsByClassName("medium-editor-insert-action")[0],s=window.getComputedStyle(i),o=window.getComputedStyle(n),a={top:window.scrollY+e.top,left:window.scrollX+e.left-parseInt(s.left,10)-parseInt(o.marginLeft,10)},a.left=a.left<0?e.left:a.left,this.buttons.style.left=a.left+"px",this.buttons.style.top=a.top+"px")}},{key:"toggleButtons",value:function(){var t=this._editor.getSelectedParentElement();this.shouldDisplayButtonsOnElement(t)?(this.selectElement(t),this.showButtons()):(this.deselectElement(),this.hideButtons())}},{key:"shouldDisplayButtonsOnElement",value:function(t){var e=this,i=[],n=!1,s=!1;return""!==t.innerText.trim()?!1:(this._plugin.getEditorElements().forEach(function(e){return u["default"].isChildOf(t,e)?void(s=!0):void 0}),s?(Object.keys(this._plugin.initializedAddons).forEach(function(t){var n=e._plugin.initializedAddons[t];n.elementClassName&&i.push(n.elementClassName)}),i.forEach(function(e){return t.classList.contains(e)||u["default"].getClosestWithClassName(t,e)?void(n=!0):void 0}),!n):!1)}},{key:"selectElement",value:function(t){this.selectedElement=t}},{key:"deselectElement",value:function(){this.selectedElement=null}},{key:"showButtons",value:function(){this.buttons.classList.add("medium-editor-insert-buttons-active"),this.positionButtons()}},{key:"hideButtons",value:function(){this.buttons.classList.remove("medium-editor-insert-buttons-active"),this.buttons.classList.remove("medium-editor-insert-addons-active")}},{key:"toggleAddons",value:function(){this.buttons.classList.toggle("medium-editor-insert-addons-active")}},{key:"handleAddonClick",value:function(t){var e=t.currentTarget.getAttribute("data-addon");t.preventDefault(),this._plugin.initializedAddons[e].handleClick(t)}}]),t}();e["default"]=f,t.exports=e["default"]},function(t,e){"use strict";function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0});var n=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),s=function(){function t(e,n){i(this,t),this._plugin=e,this._editor=this._plugin.base,this.options={label:'<span class="fa fa-youtube-play"></span>'},Object.assign(this.options,n),this.label=this.options.label}return n(t,[{key:"handleClick",value:function(){window.console.log("embeds clicked")}}]),t}();e["default"]=s,t.exports=e["default"]},function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{"default":t}}function s(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0});var o=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),a=i(1),u=n(a),l=function(){function t(e,i){s(this,t),this.options={label:'<span class="fa fa-camera"></span>',preview:!0,uploadUrl:"upload.php"},Object.assign(this.options,i),this._plugin=e,this._editor=this._plugin.base,this.elementClassName="medium-editor-insert-images",this.label=this.options.label,this.events()}return o(t,[{key:"events",value:function(){var t=this;this._plugin.on(document,"click",this.unselectImage.bind(this)),this._plugin.getEditorElements().forEach(function(e){t._plugin.on(e,"click",t.selectImage.bind(t))})}},{key:"handleClick",value:function(){this._input=document.createElement("input"),this._input.type="file",this._input.multiple=!0,this._plugin.on(this._input,"change",this.uploadFiles.bind(this)),this._input.click()}},{key:"uploadFiles",value:function(){var t=this,e=this._plugin.core.selectedElement;if("p"===e.nodeName.toLowerCase()){var i=document.createElement("div");e.parentNode.insertBefore(i,e),this._plugin.core.selectElement(i),e.remove()}Array.prototype.forEach.call(this._input.files,function(e){var i=u["default"].generateRandomString();t.options.preview&&t.preview(e,i),t.upload(e,i)}),this._plugin.core.hideButtons()}},{key:"preview",value:function(t,e){var i=this,n=new FileReader;n.onload=function(t){i.insertImage(t.target.result,e)},n.readAsDataURL(t)}},{key:"upload",value:function(t,e){var i=this,n=new XMLHttpRequest,s=new FormData;n.open("POST",this.options.uploadUrl,!0),n.onreadystatechange=function(){if(4===n.readyState&&200===n.status){var t=i._plugin.core.selectedElement.querySelector('[data-uid="'+e+'"]');t?i.replaceImage(t,n.responseText):i.insertImage(n.responseText)}},s.append("file",t),n.send(s)}},{key:"insertImage",value:function(t,e){var i=this._plugin.core.selectedElement,n=document.createElement("figure"),s=document.createElement("img"),o=new Image;return s.alt="",e&&s.setAttribute("data-uid",e),t.match(/^data:/)?(s.src=t,n.appendChild(s),i.appendChild(n)):(o.onload=function(){s.src=o.src,n.appendChild(s),i.appendChild(n)},o.src=t),i.classList.add(this.elementClassName),o}},{key:"replaceImage",value:function(t,e){var i=new Image;return i.onload=function(){t.src=i.src,t.removeAttribute("data-uid")},i.src=e,i}},{key:"selectImage",value:function(t){var e=t.target;"img"===e.nodeName.toLowerCase()&&u["default"].getClosestWithClassName(e,this.elementClassName)&&e.classList.add("medium-editor-insert-image-active")}},{key:"unselectImage",value:function(t){var e=t.target,i=void 0;"img"===e.nodeName.toLowerCase()&&e.classList.contains("medium-editor-insert-image-active")&&(i=e),this._plugin.getEditorElements().forEach(function(t){var e=t.getElementsByClassName("medium-editor-insert-image-active");Array.prototype.forEach.call(e,function(t){t!==i&&t.classList.remove("medium-editor-insert-image-active")})})}}]),t}();e["default"]=l,t.exports=e["default"]}])});
//# sourceMappingURL=medium-editor-insert.min.js.map